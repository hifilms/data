<!DOCTYPE html>
<html>
<head>
    <style>
        /* (App Store UI CSS) */
        body { margin: 0; padding: 20px; font-family: sans-serif; background-color: #fff; color: #333; }
        .app-item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        .app-item img { width: 48px; height: 48px; margin-right: 15px; }
        .install-btn { padding: 8px 15px; background-color: #2ecc71; color: white; border: none; cursor: pointer; }
        .uninstall-btn { padding: 8px 15px; background-color: #e74c3c; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>WebOS App Store</h1>
    <div class="app-list" id="app-list">Loading apps...</div>

    <script>
        async function renderAppList() {
            const listDiv = document.getElementById('app-list');
            listDiv.innerHTML = 'Loading available apps...'; 
            
            const availableApps = await window.parent.getAvailableApps();
            const installedApps = window.parent.getInstalledApps();
            
            listDiv.innerHTML = ''; 

            if (availableApps.length === 0) {
                 listDiv.innerHTML = '<p>কোনো অ্যাপ নেই।</p>';
                 return;
            }

            availableApps.forEach(app => {
                const isInstalled = installedApps.find(a => a.appName === app.appName);
                const btnText = isInstalled ? 'Uninstall' : 'Install';
                const btnClass = isInstalled ? 'uninstall-btn' : 'install-btn';
                
                const appElement = document.createElement('div');
                appElement.className = 'app-item';
                appElement.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        <img src="${app.iconUrl}" alt="${app.appName} Icon" width="48" height="48">
                        <strong>${app.appName}</strong>
                    </div>
                    <button class='${btnClass}' data-name='${app.appName}' data-icon='${app.iconUrl}' data-url='${app.sourceUrl}'>${btnText}</button>
                `;
                listDiv.appendChild(appElement);
            });
        }

        document.addEventListener('click', (e) => {
            const target = e.target;
            if(target.tagName === 'BUTTON') {
                const name = target.dataset.name;
                
                if(target.classList.contains('install-btn')) {
                    const meta = { appName: name, iconUrl: target.dataset.icon, sourceUrl: target.dataset.url };
                    if(window.parent.installApp(meta)) {
                        renderAppList();
                    }
                } else if(target.classList.contains('uninstall-btn')) {
                    window.parent.uninstallApp(name);
                    renderAppList();
                }
            }
        });

        renderAppList();
    </script>
</body>
</html>